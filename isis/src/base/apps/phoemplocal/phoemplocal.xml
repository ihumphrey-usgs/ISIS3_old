<?xml version="1.0" encoding="UTF-8"?>

<application name="phoemplocal" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">
 
  <brief>
    Fit empirical photometric functions to Hapke
  </brief>
  
  <description>
    <pre>
    This program finds lunar-Lambert or Minnaert photometric functions
    to approximate a more realistic but more complex Hapke model.
    The program is based on PHO_FIT_GLOBAL with the following differences:
    The fit is performed at a single geometry rather than for a range of phase 
    angles.  The user specifies the phase angle and the incidence and emission 
    angles of the mean ground plane (datum), as well as the RMS slope relative to 
    the dataum.  Artificial data are then created, with slopes drawn from an 
    isotropic Gaussian distribution relative to the datum.  The simpler model is 
    fit at these orientations to the Hapke model by adjusting its one parameter 
    and its overall brightness so that the sum-squared-residual between the two is 
    minimized.  Both the parameter (which, for both types of simple model, mainly 
    controls limb darkening) and the brightness (normalized as an empirical phase 
    curve) are reported.

    This program should serve as a clear example for developing a new program 
    PHO_FIT_IMAGE to fit the parameter of an empirical photometric function to 
    part of an actual image. The differences can be summarized as follows:
         1) Fit is done only once (not in a table vs. phase angle)
            since the input image has a fixed geometry.
         2) The data to be fit *to* are obtained from an ISIS cube plane
           rather than calculated in GET_HAPKE_IMG.
         3) Similarly, the incidence, emission, and phase angles are
            obtained from backplanes of the same cube and maintained
            in buffers corresponding point-for-point with the image.
            The routine to pull values out of these buffers at the
            current pixel can look identical to GET_ANGLES.
         4) Both image data and angles should be stored in R*4 buffers
            and converted to double precision before being used.
         5) Optionally, a region-of-interest mask could be obtained
            from a backplane and only those pixels in the ROI used
            in the fit.  This would be in addition on the incidence
            and emission angle tests already in the code.
    </pre>
  </description>

  <category>
    <categoryItem>Radiometric and Photometric Correction</categoryItem>
  </category>

  <history>
    <change name="Randy Kirk" date= "1999-11-16">
        USGS Flagstaff Original Version
    </change>
    <change name="Janet Barrett"  date="2003-01-13">
      Ported pho_fit_local from the VAX and renamed it 
      pho_emp_local in isis2
    </change>
    <change name="Sharmila Prasad" date="2011-08-04">
      Isis3 Original version, pho_emp_local ported from isis2 to isis3 
      phoemplocal 
    </change>
  </history>

  <groups>
    <group name="Files">
      <parameter name="TO">
        <type>filename</type>
        <fileMode>output</fileMode>
        <brief>
            Output text file to contain fit parameters
        </brief>
        <internalDefault>
          None
        </internalDefault>
        <description>
          The output file has a table whose columns give the phase angle,
          best-fit limb darkening parameter, best-fit brightness both in absolute units
          and relative to the zero phase model and RMS residual to the fit.
        </description>
        <filter>
          *.txt
        </filter>
      </parameter>
      <parameter name="APPEND">
        <type>boolean</type>
        <brief>
          Append Output to File
        </brief>
        <description>
          If this option is selected, the output from the application will be appended to the file.
          If it is not selected, any information in the TO file will be overwritten.
        </description>
        <default><item>FALSE</item></default>
      </parameter>
    </group>

     <group name="User Note">
       <parameter name="NOTE">
        <type>string</type>
        <brief>
            User note to be added to output file
        </brief>
        <internalDefault>None</internalDefault>
        <description>
          The user can specify a note to be added to the output file using this parameter.
        </description>
       </parameter>
    </group>

     <group name="Hapke">
      <parameter name="PHTNAME">
        <type>combo</type>
        <internalDefault>HAPKEHEN</internalDefault>
        <default>
          <item>HAPKEHEN</item>
        </default>
        <brief>Phase Function Type</brief>
        <description>
        </description>

        <list>
          <option value="HAPKEHEN">
            <brief> Hapke-Henyey-Greenstein photometric model</brief>
            <description>
            </description>
            <exclusions>
              <item>BH</item>
              <item>CH</item>
            </exclusions>
         </option>
         <option value="HAPKELEG">
           <brief> Hapke-Legendre-Polynomial photometric model</brief>
           <description>
           </description>
           <exclusions>
             <item>HG1</item>
             <item>HG2</item>
           </exclusions>
         </option>
        </list>
      </parameter>

       <parameter name="WH">
        <type>double</type>
        <brief>Single Scattering Albedo</brief>
        <internalDefault>None</internalDefault>
        <description>Single Scattering Albedo</description> 
      </parameter>

       <parameter name="HH">
        <type>double</type>
        <brief>Opposition Surge Width</brief>
        <internalDefault>None</internalDefault>
        <description>Opposition Surge Width. ZEROs are strongly advised as the simple models 
        #do not fit the opposition effect well</description> 
      </parameter>

       <parameter name="B0">
        <type>double</type>
        <brief>Opposition Surge Strength</brief>
        <internalDefault>None</internalDefault>
        <description>Opposition Surge Strength. ZEROs are strongly advised as 
        the simple models #do not fit the opposition effect well
        </description>
      </parameter>

       <parameter name="THETA">
        <type>double</type>
        <brief>Surface roughness in degrees</brief>
        <internalDefault>None</internalDefault>
        <description>Small scale surface roughness in degrees</description> 
      </parameter> 

       <parameter name="HG1">
        <type>double</type>
        <brief>Henyey-Greenstein coefficient 1</brief>
        <internalDefault>None</internalDefault>
        <description>Henyey-Greenstein coefficients for alternate phase 
          function</description>
      </parameter>

       <parameter name="HG2">
        <type>double</type>
        <brief>Henyey-Greenstein coefficient 2</brief> 
        <internalDefault>None</internalDefault>
        <description>Henyey-Greenstein coefficients for alternate phase 
          function</description>
      </parameter>

       <parameter name="BH">
        <type>double</type>
        <brief>Legendre coefficient 1</brief>
        <internalDefault>None</internalDefault>
        <description>Coefficient of P1(cos(phase)) in single particle phase
        for Legendre Function </description> 
      </parameter>

       <parameter name="CH">
        <type>double</type>
        <brief>Legendre coefficient 2</brief>
        <internalDefault>None</internalDefault>
        <description>Coefficient of P1(cos(phase)) in single particle phase
        for Legendre Function</description>
      </parameter>
    </group>

    <group name="Empirical">
         <parameter name="MODEL">
          <type>combo</type>
          <internalDefault>LunarLambert</internalDefault>
          <brief>
          </brief>
          <description>
          </description>
          <list>
            <option value="LUNARLAMBERT">
              <brief>Lunar-Lambert Empirical Photometric Function</brief>
              <description>Include Lunar-Lambert Empirical Photometric Function to 
              the Hapke Model 
              </description>
            </option>
            <option value="MINNAERT">
              <brief>Minnaert Empirical Photometric Function</brief>
              <description>Include Minnaert Empirical Photometric Function to 
              the Hapke Model
              </description>
            </option>
          </list>
        </parameter>
      </group>

    <group name="Atmospheric Scattering Model(ATM)">
      <parameter name="ATMNAME">
        <type>combo</type>
        <internalDefault>NONE</internalDefault>
        <default>
          <item>NONE</item>
        </default>
        <brief>
	       </brief>
        <description>
        </description>
        <list>  
          <option value="NONE">
            <brief>No Atmospheric Scattering Model</brief>
            <description>
            </description>
            <exclusions>
              <item>TAU</item>
              <item>WHA</item>
              <item>HGA</item>
              <item>HNORM</item>
              <item>IORD</item>
              <item>BHA</item>
            </exclusions>
          </option>
            <option value="ISOTROPIC1">
            <brief>First Order Isotropic</brief>
            <description> </description> 
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
                <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
              <exclusions>
                <item>HGA</item>
                <item>BHA</item>
              </exclusions>
          </option>
          <option value="ISOTROPIC2">
            <brief>Second Isotropic</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>HGA</item>
                <item>BHA</item>
             </exclusions>
          </option>
          <option value="ANISOTROPIC1">
            <brief>First Order Anisotropic</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>BHA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>HGA</item>
             </exclusions>
          </option>
          <option value="ANISOTROPIC2">
            <brief>Second Order Anisotropic</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>BHA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>HGA</item>
            </exclusions>
          </option>
          <option value="HAPKEATM1">
            <brief>First Order Henyey-Greenstein</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>HGA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>BHA</item>
            </exclusions>
          </option>
          <option value="HAPKEATM2">
            <brief>Second Order Henyey-Greenstein</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>HGA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>BHA</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name="TAU">
        <type>double</type>
        <brief>Normal atmospheric optical depth</brief>
        <internalDefault>None</internalDefault>
        <description>Normal atmospheric optical depth</description>
      </parameter>

      <parameter name="WHA">
        <type>double</type>
        <brief>Single-scattering albedo</brief>
        <internalDefault>None</internalDefault>
        <description>Single-scattering albedo of atmospheric 
          particles</description>
      </parameter>

      <parameter name="HGA">
        <type>double</type>
        <brief>Coeff of atmospheric particle Henyey-Greenstein</brief>
        <internalDefault>None</internalDefault>
        <description>Coeff of atmospheric particle Henyey-Greenstein phase 
          function</description>
      </parameter>

      <parameter name="BHA">
        <type>double</type>
        <brief>Coeff of atmospheric particle Legendre phase function
        </brief>
        <internalDefault>None</internalDefault>
        <description>Coeff of atmospheric particle Legendre phase function. This 
        parameter is limited to values that are  GreaterThan Equal to -1 and 
        LessThanEqual to 1.</description>
      </parameter>

      <parameter name="HNORM">
        <type>double</type>
        <brief>Atmospheric shell thickness</brief>
        <internalDefault>None</internalDefault>
        <description>Atmospheric shell thickness normalized to planet radius.
        Default 0.003 is for Mars.</description>
      </parameter>

      <parameter name="IORD">
        <type>boolean</type>
        <brief>Allow additive offset in fit</brief>
        <default>
          <item>false</item>
        </default>
        <description>If true, the additive contribution of the atmosphere will 
        be modeled by an additive constant in the fit. Allow additive offset in 
        fit 
        </description>
      </parameter>
    </group>

    <group name="Mean Ground Plane(Datum) Geometry">
      <parameter name="EMISSION">
        <type>double</type>
        <internalDefault>None</internalDefault>
        <brief>
        </brief>
        <description>
        </description>
      </parameter>

      <parameter name="PHASE">
        <type>double</type>
        <internalDefault>None</internalDefault>
        <brief>
        </brief>
        <description>
        </description>
      </parameter>

      <parameter name="INCIDENCE">
        <type>double</type>
        <internalDefault>None</internalDefault>
        <brief>
        </brief>
        <description>
        </description>
      </parameter>

      <parameter name="RMS_SLOPE">
        <type>double</type>
        <internalDefault>None</internalDefault>
        <brief>
        </brief>
        <description>
        </description>
      </parameter>
      </group>

    <group name="Random Number Generator">
      <parameter name="SEED">
        <type>boolean</type>
        <brief>User Specified Seed</brief>
        <default><item>false</item></default>
        <description>If enabled the app uses the user defined 
          number as the starting seed for randomn number generator</description>
        <inclusions>
          <item>SEED_NUMBER</item>
        </inclusions>
      </parameter>
      <parameter name="SEED_NUMBER">
        <type>integer</type>
        <brief>Starting Seed Number</brief>
        <description>
          Starting seed number for randomn number generator
        </description> 
        <internalDefault>None</internalDefault>
      </parameter>
    </group>
  </groups>
</application>
