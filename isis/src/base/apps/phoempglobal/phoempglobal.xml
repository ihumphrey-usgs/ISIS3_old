<?xml version="1.0" encoding="UTF-8"?>

<application name="phoempglobal" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd"> 
  <brief>
    Fit empirical photometric functions to Hapke
  </brief>
  
  <description>
    <pre>
   This program finds lunar-Lambert or Minnaert photometric functions to 
   approximate a more realistic but more complex Hapke (1981; 1984; 1986) 
   model.  At each of a range of phase angles, the simpler model is fit to 
   the Hapke model by adjusting its one parameter and its overall brightness 
   so that the sum-squared-residual between the two is minimized. Both the 
   parameter (which, for both types of simple model, mainly controls limb 
   darkening) and the brightness (normalized 
   as an empirical phase curve) are reported in a table against phase angle. 
   In this program, the fit is over a portion of the visible 
   hemisphere of an idealized planet, and a table of results vs phase angle 
   is output.  This type of fit is useful for building an empirical
   photometric function to be used in program photomet for normalizing
   images for mosaicking.  The companion program pho_emp_local can be
   used to perform a single fit at fixed incidence/emission/phase
   geometry to determine the photometric parameter for photoclinometry
   with a particular image.

   For the original description of the fitting process and a useful 
   compilation of Hapke parameters from the scientific literature, see McEwen 
   (1991). The atmospheric model used in the fits is discussed by Kirk et al. 
   (2000, 2001).

   The following Hapke parameters for Mars are from Johnson
   et al. (1999) for IMP data of Photometry Flats (soil) and may be 
   reasonably representative of Mars as a whole. 
   Note that (HG1, HG2=1.0) is equivalent to (-HG1, HG2=0.0) 

   Band    WH     B0     HH    HG1    HG2 
   Red    0.52  0.025  0.170  0.213 1.000 
   Green  0.29  0.290  0.170  0.190 1.000 
   Blue   0.16  0.995  0.170  0.145 1.000 

   Kirk et al. (2000) found that Mars whole-disk limb-darkening data of 
   Thorpe (1973) are consistent with THETA=30, but results of Tanaka and 
   Davis (1988) based on matching photoclinometry of local areas to shadow 
   data are more consistent with THETA=20 when the domain of the fit is 
   restricted to small emission angles (=&lt; 20 degrees).

   Values of the photometric parameters for the martian atmosphere, adopted 
   from Tomasko et al. (1999) are:

   Band  WHA     HGA 
   Red    0.95     0.68 
   Blue   0.76     0.78 

   Hapke, B. W., 1981. Bidirectional reflectance spectroscopy 
   1: Theory. J. Geophys. Res., pp. 86,3039-3054.

   Hapke, B., 1984. Bidirectional reflectance spectroscopy 
   3: Corrections for macroscopic roughness. Icarus, 59, pp. 41-59.

   Hapke, B., 1986. Bidirectional reflectance spectroscopy 
   4: The extinction coefficient and the opposition effect. 
   Icarus, 67, pp. 264-280.

   Johnson, J. R., et al., 1999, Preliminary Results on Photometric 
   Properties of Materials at the Sagan Memorial Station, Mars, 
   J. Geophys. Res., 104, 8809. 

   Kirk, R. L., Thompson, K. T., Becker, T. L., and Lee, E. M., 
   2000. Photometric modelling for planetary cartography. 
   Lunar Planet. Sci., XXXI, Abstract #2025, Lunar 
   and Planetary Institute, Houston (CD-ROM).

   Kirk, R. L., Thompson, K. T., and Lee, E. M., 2001. 
   Photometry of the martian atmosphere:  An improved 
   practical model for cartography and photoclinometry. 
   Lunar Planet. Sci., XXXII, Abstract #1874, Lunar 
   and Planetary Institute, Houston (CD-ROM). 

   McEwen, A. S., 1991. Photometric functions for photo-
   clinometry and other applications.  Icarus, 92, pp. 298-311.

   Tanaka, K. L., and and Davis, P. A., 1988, Tectonic History of 
   the Syria Planum Provice of Mars, J. Geophys. Res., 93, 14,893. 

   Thorpe, T. E., 1973, Mariner 9 Photometric Observations of Mars 
   from November 1971 through March 1972, Icarus, 20, 482.

   Tomasko, M. G., et al., 1999, Properties of Dust in the Martian 
   Atmosphere from the Imager on Mars Pathfinder, J. Geophys. Res., 
   104, 8987

   Programmer: Randolph Kirk, U.S.G.S., Flagstaff, AZ
  </pre>
  </description>

  <category>
    <categoryItem>Radiometric and Photometric Correction</categoryItem>
  </category>

  <history>
    <change name="Randy Kirk" date= "1999-11-16">
        USGS Flagstaff Original Version
    </change>
    <change name="Janet Barrett"  date="2003-01-13">
      Ported pho_fit_global from the VAX and renamed it 
      pho_emp_global in isis2
    </change>
    <change name="Sharmila Prasad" date="2011-08-24">
      Isis3 Original version, pho_emp_global  ported from isis2 to isis3 
      phoempglobal 
    </change>
  </history>

  <groups>
    <group name="Files">
      <parameter name="TO">
        <type>filename</type>
        <fileMode>output</fileMode>
        <brief>
            Output text file contain fit parameters
        </brief>
        <description>
        This output is an ASCII file containing a header recording
        all parameter values including the user NOTE, followed by a table with 
        one row for each phase angle.  Columns give the phase angle, best-fit 
        limb darkening parameter, best-fit brightness both in absolute units and 
        relative to the zero-phase model, and RMS residual to the fit.
        </description>
        <filter>
          *.txt
        </filter>
      </parameter>
    </group>

    <group name="User Note">
       <parameter name="NOTE">
        <type>string</type>
        <brief>
            User note to be added to output file
        </brief>
        <internalDefault>None</internalDefault>
        <description>
          The user can specify a note to be added to the output file using this parameter.
        </description>
       </parameter>
    </group>

     <group name="HAPKE">
      <parameter name="PHTNAME">
        <type>combo</type>
        <default>
          <item>HENYEY-GREENSTEIN</item>
        </default>
        <brief>Phase Function Type</brief>
        <description>
        </description>

        <list>
          <option value="HAPKEHEN">
            <brief> Hapke-Henyey-Greenstein photometric model</brief>
            <description>
            </description>
            <exclusions>
              <item>BH</item>
              <item>CH</item>
            </exclusions>
         </option>
         <option value="HAPKELEG">
           <brief> Hapke-Legendre-Polynomial photometric model</brief>
           <description>
           </description>
           <exclusions>
             <item>HG1</item>
             <item>HG2</item>
           </exclusions>
         </option>
        </list>
      </parameter>

       <parameter name="WH">
        <type>double</type>
        <brief>Single Scattering Albedo</brief>
        <internalDefault>None</internalDefault>
        <description>Single-scattering albedo of surface particles. See Hapke 
        (1981).  Not to be confused with albedo WHA of the atmospheric 
        particles.</description> 
      </parameter>

       <parameter name="HH">
        <type>double</type>
        <brief>Opposition Surge Width</brief>
        <internalDefault>None</internalDefault>
        <description>Opposition Surge Width. ZEROs are strongly advised as the simple models 
        #do not fit the opposition effect well. See Hapke (1984)</description> 
      </parameter>

       <parameter name="B0">
        <type>double</type>
        <brief>Opposition Surge Strength</brief>
        <internalDefault>None</internalDefault>
        <description>Opposition Surge Strength. Magnitude of the opposition 
        effect for the surface. ZEROs are strongly advised as the simple models 
        #do not fit the opposition effect well. See Hapke (1984)
        </description>
      </parameter>

       <parameter name="THETA">
        <type>double</type>
        <brief>Surface roughness in degrees</brief>
        <internalDefault>None</internalDefault>
        <description>Small scale surface roughness in degrees. "Macroscopic roughness" of the surface as it affects the
        photometric behavior.  This is the RMS slope at scales larger than the  
        distance photons penetrate the surface but smaller than a pixel.  See 
        Hapke (1986).</description> 
      </parameter> 

       <parameter name="HG1">
        <type>double</type>
        <brief>Henyey-Greenstein coefficient 1</brief>
        <internalDefault>None</internalDefault>
        <description>Asymmetry parameter used in the Henyey-Greenstein model
        for the scattering phase function of single particles in the surface, 
        used if PHASEFUNC=HENYEY-GREENSTEIN.  See Hapke (1981).  The 
        two-parameter Henyey-Greenstein function is P(phase) = (1-HG2) * 
        (1-HG1**2)/(1+HG1**2+2*HG1*COS(PHASE))**1.5 +    HG2  * 
        (1-HG1**2)/(1+HG1**2-2*HG1*COS(PHASE))**1.5
        </description>
      </parameter>

       <parameter name="HG2">
        <type>double</type>
        <brief>Henyey-Greenstein coefficient 2</brief> 
        <internalDefault>None</internalDefault>
        <description>Second parameter of the two-parameter Henyey-Greenstein
        model for the scattering phase function of single particles in the 
        surface, used if PHASEFUNC=HENYEY-GREENSTEIN.  This parameter controls a 
        the proportions in a linear mixture of ordinary Heneyey- Greenstein 
        phase functions with asymmetry parameters equal to +HG1 and -HG1.  See 
        HG1 for the full formula.
       </description>
      </parameter>

       <parameter name="BH">
        <type>double</type>
        <brief>Legendre coefficient 1</brief>
        <internalDefault>None</internalDefault>
        <description>Coefficient of P1(cos(phase)) in single particle phase
        for Legendre Function. When PHASEFUNC=LEGENDRE, a two-term Legendre 
        polynomial is used for the scattering phase function of single 
        particles in the surface P(phase) = 1 + BH * P1(COS(PHASE)) + CH * 
        P2(COS(PHASE))
       </description> 
      </parameter>

       <parameter name="CH">
        <type>double</type>
        <brief>Legendre coefficient 2</brief>
        <internalDefault>None</internalDefault>
        <description>Coefficient of P1(cos(phase)) in single particle phase
        for Legendre Function. When PHASEFUNC=LEGENDRE, a two-term Legendre polynomial
        is used for the scattering phase function of single particles in the 
        surface P(phase) = 1 + BH * P1(COS(PHASE)) + CH * 
        P2(COS(PHASE))</description>
      </parameter>
    </group>

    <group name="Empirical">
         <parameter name="MODEL">
          <type>combo</type>
          <internalDefault>LunarLambert</internalDefault>
          <brief>Determines which empirical photometric function will be fitted
          to the Hapke model.</brief>
          <description>Determines which empirical photometric function will be fitted
          to the Hapke model.The tables of B and L or B and K can be used with 
          the lunar-Lambert empirical or Minnaert empirical photometric
          functions in the photometric normalization program photomet. Output 
          from this program will have to be reformatted as described in 
          photomet.pdf 
          </description>
          <list>
            <option value="LUNARLAMBERT">
              <brief>Lunar-Lambert Empirical Photometric Function</brief>
              <description>Include Lunar-Lambert Empirical Photometric Function to 
              the Hapke Model.
              Lunar-Lambert FUNC=B(phase) * ((1-L)*u0 + 2*L*u0/(u0+u))
              </description>
            </option>
            <option value="MINNAERT">
              <brief>Minnaert Empirical Photometric Function</brief>
              <description>Include Minnaert Empirical Photometric Function to 
              the Hapke Model.
              Minnaert FUNC=B(phase) * u0**K(phase) * u**(K(phase)-1)
              </description>
            </option>
          </list>
        </parameter>
      </group>

    <group name="Atmospheric Scattering Model(ATM)">
      <parameter name="ATMNAME">
        <type>combo</type>
        <internalDefault>NONE</internalDefault>
        <default>
          <item>NONE</item>
        </default>
        <brief>
	       </brief>
        <description>If selected, an atmospheric scattering model will be 
        applied in addition to the surface Hapke model. This atmospheric model 
        uses a Hapke-like approach of combining an anisotropic model for 
        multiple scattering with an isotropic model (one parameter 
        Henyey-Greenstein) for single scattering.  The atmospheric scattering 
        both attenuates the surface signal and adds its own contribution to the 
        radiance.  If ASM selected it therefore makes sense to also set IORD=YES 
        so that the additive contribution of the atmosphere will be modeled by 
        an additive constant in the fit.
        </description>
        <list>  
          <option value="NONE">
            <brief>No Atmospheric Scattering Model</brief>
            <description>
            </description>
            <exclusions>
              <item>TAU</item>
              <item>WHA</item>
              <item>HGA</item>
              <item>HNORM</item>
              <item>IORD</item>
              <item>BHA</item>
            </exclusions>
          </option>
            <option value="ISOTROPIC1">
            <brief>First Order Isotropic</brief>
            <description> </description> 
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
                <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
              <exclusions>
                <item>HGA</item>
                <item>BHA</item>
              </exclusions>
          </option>
          <option value="ISOTROPIC2">
            <brief>Second Isotropic</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>HGA</item>
                <item>BHA</item>
             </exclusions>
          </option>
          <option value="ANISOTROPIC1">
            <brief>First Order Anisotropic</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>BHA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>HGA</item>
             </exclusions>
          </option>
          <option value="ANISOTROPIC2">
            <brief>Second Order Anisotropic</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>BHA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>HGA</item>
            </exclusions>
          </option>
          <option value="HAPKEATM1">
            <brief>First Order Henyey-Greenstein</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>HGA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>BHA</item>
            </exclusions>
          </option>
          <option value="HAPKEATM2">
            <brief>Second Order Henyey-Greenstein</brief>
            <description>
            </description>
            <inclusions> 
               <item>TAU</item>
               <item>WHA</item>
               <item>HGA</item>
               <item>HNORM</item>
               <item>IORD</item>
            </inclusions>
            <exclusions>
                <item>BHA</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name="TAU">
        <type>double</type>
        <brief>Normal atmospheric optical depth</brief>
        <internalDefault>None</internalDefault>
        <description>Normal atmospheric optical depth</description>
      </parameter>

      <parameter name="WHA">
        <type>double</type>
        <brief>Single-scattering albedo</brief>
        <internalDefault>None</internalDefault>
        <description>Single-scattering albedo of atmospheric 
          particles</description>
      </parameter>

      <parameter name="HGA">
        <type>double</type>
        <brief>Coeff of atmospheric particle Henyey-Greenstein</brief>
        <internalDefault>None</internalDefault>
        <description>Coeff of atmospheric particle Henyey-Greenstein phase 
          function. Henyey-Greenestein asymmetry parameter for atmospheric particle
          phase function, Not to be confused with corresponding parameter HG1 
          for the surface particles.</description>
      </parameter>

      <parameter name="BHA">
        <type>double</type>
        <brief>Coeff of atmospheric particle Legendre phase function
        </brief>
        <internalDefault>None</internalDefault>
        <description>Coeff of atmospheric particle Legendre phase function. This 
        parameter is limited to values that are  GreaterThan Equal to -1 and 
        LessThanEqual to 1.</description>
      </parameter>

      <parameter name="HNORM">
        <type>double</type>
        <brief>Atmospheric shell thickness</brief>
        <internalDefault>None</internalDefault>
        <description>Atmospheric shell thickness normalized to planet radius.
        Default 0.003 is for Mars.</description>
      </parameter>

      <parameter name="IORD">
        <type>boolean</type>
        <brief>Allow additive offset in fit</brief>
        <default>
          <item>false</item>
        </default>
        <description>If true, the additive contribution of the atmosphere will 
        be modeled by an additive constant in the fit. Allow additive offset in 
        fit 
        </description>
      </parameter>
    </group>

      <group name="Fit Range of Angles">
        <parameter name="EMAMIN">
          <type>double</type>
          <brief>Minimum Emission Angle</brief>
          <internalDefault>None</internalDefault>
          <description>Minimum emission angle included in the fit
          </description>
        </parameter>

        <parameter name="EMAMAX">
          <type>double</type>
          <brief>Maximum Emission Angle</brief>
          <internalDefault>None</internalDefault>
          <description>Maximum emission angle included in the fit
          </description>
        </parameter>

        <parameter name="EMAMAX_PHASE_COEFF">
          <type>double</type>
          <brief>Fraction of phase angle to add to maximum emission 
            angle</brief> 
          <internalDefault>None</internalDefault>
          <description>EMAMAX_PCOEFF allows the range of emission angles included
          in the fit to increase slightly at high phase angles, because 
          otherwise the region of fit becomes very small. 
          </description>
        </parameter>
      
         <parameter name="INCMIN">
          <brief>Minimum Incidence Angle</brief>
          <type>double</type>
          <internalDefault>None</internalDefault>
          <description>Minimum incidence angle included in the fit. The 
          empirical photometric function will be fitted to the Hapke model over 
          a portion of the visible hemisphere of an idealized planet, with 
          INCMIN =&lt; incidence angle =&lt; INCMAX EMAMIN =&lt; emission angle 
          =&lt; EMAMAX + EMAMAX_PCOEFF * phase 
          INCMIN and EMAMIN are normally set to 0 and INCMAX and EMAMAX to 
          values approaching 90 to exclude only limited regions near the limb 
          and terminator from the fit.  EMAMAX_PCOEFF allows the emission angle 
          limit to increase slightly at high phase angles, because otherwise the 
          region of fit becomes very small. 
        </description>
        </parameter>

        <parameter name="INCMAX">
          <brief>Maximum Incidence Angle</brief>
          <type>double</type>
          <internalDefault>None</internalDefault>
          <description>Maximum incidence angle included in the fit
          </description>
        </parameter>

        <parameter name="PHMIN">
          <brief>Minimum Phase Angle</brief>
          <type>double</type>
          <internalDefault>None</internalDefault>
          <description>Minimum phase angle at which a fit will be performed, 
          corresponding to the first row of the output table.</description>
        </parameter>

      <parameter name="PHMAX">
          <brief>Maximum Phase Angle</brief>
          <type>double</type>
          <internalDefault>None</internalDefault>
          <description>Maximum phase angle at which a fit will be performed, 
          corresponding to the last row of the output table.</description>
        </parameter>

        <parameter name="NPH">
          <brief>Number of phase angles</brief>
          <type>integer</type>
          <internalDefault>None</internalDefault>
          <description>Number of phase angles at which a fit will be performed,
          equal to the number of rows in the output table.</description>
        </parameter>
    </group>
  </groups>
</application>
