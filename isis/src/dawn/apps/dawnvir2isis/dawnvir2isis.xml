<?xml version="1.0" encoding="UTF-8"?>
<application name="dawnvir2isis" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">

  <brief>Import PDS formatted DAWN VIR EDR or RDR image cube into Isis format cube</brief>

  <description>
    This program will import a PDS formatted DAWN Visual and InfraRed Mapping
    Spectrometer (VIR) level 1a (EDR) or level 1b (RDR) image into an ISIS cube.  
    It supports ingestion of detached PDS labels.  The file containing the label 
    needs to be provided in the FROM parameter.  If it is not the actual image 
    data, it will search for a file with the same base name and suffix with 
    .QUB. 
  </description>

  <history>
    <change name="Janet Barrett" date="2010-03-31">
      Original version
    </change>
    <change name="Janet Barrett" date="2010-11-15">
      Added capability to read detached labels
    </change>
      <change name="Kris Becker" date="2011-03-09">
          Updated documentation
      </change>
     <change name="Kris Becker" date="2011-03-14">
          Removed HorixontalPixelScale and VerticalPixelScale compliancy test; 
          Added optional TARGET parameter to allow TargetName specification 
     </change>
     <change name="Kris Becker" date="2011-06-29">
          Added ingestion of PDS table data file for camera model support
     </change>
  </history>

  <category>
    <categoryItem>Import and Export</categoryItem>
  </category>

  <groups>
    <group name="Files">
      <parameter name="FROM">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Input PDS formatted DAWN VIR EDR or RDR file
        </brief>
        <description>
          Use this parameter to select the DAWN VIR EDR or RDR filename. This 
          file must contain the PDS labels. However, the image data can be 
          detached and will automatically be obtained from the PDS image pointer 
          keyword. If the pointer is incorrect, then use the IMAGE parameter to 
          specify the file containing the binary image data.
        </description>
        <filter>
          *.qub *.QUB *.lbl *.LBL *.img
        </filter>
      </parameter>

      <parameter name="IMAGE">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Detached data file
        </brief>
        <description>
          Use this parameter if the pointer to the image data in the
          detached label (FROM) is incorrect.
        </description>
        <internalDefault>
          Cube data embedded with label or file pointer in label file.
        </internalDefault>
        <filter>
          *.img *.qub *.QUB
        </filter>
      </parameter>

      <parameter name="HKFROM">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          VIR 1A/1B housekeeping (HK) data (label)
        </brief>
        <description>
            <p>
                This parameters is optional but the file is not.  It must be 
                provided.  The application will derive the expected name of the 
                input file which will always be the .LBL file describing the 
                contents of the housekeeping (HK) table file.
            </p>
            <p>
                The file is derived from the input file by first, stripping the 
                extention off the FROM file , replacing it with _HK.LBL.  It 
                will then detemine if it exists.  If it doesn't exist, then the 
                filename is scanned for '_1B_' and it is replaced with '_1A'. 
                This is because the table data for 1A (uncalibrated) images can 
                be used with 1B (calibrated) images.  
            </p>
            <p>
                If the above file determination effort fails, then the user must 
                provide the name of the housekeeping label file as this data is 
                required.
            </p>
            <p>
                For example, if the input image label file is 
                VIR_IR_1B_1_358284474_1.LBL, then the housekeeping file name 
                derived from this is VIR_IR_1B_1_358284474_1_HK.LBL.  This file 
                is unlikely to not exist so the second file name generated is 
                VIR_IR_1A_1_358284474_1_HK.LBL.  If this one does not exist, the 
                user is required to provide this in the HKFROM parameter.
            </p>
            <p>
                Note that this file is assumed to exist in the same directory as 
                the image data.  If this is not the case, then the user must 
                provide the filename.
            </p>
        </description>
        <internalDefault>Derived from input image</internalDefault>
        <filter>
          *.LBL *.TAB
        </filter>
      </parameter>

      <parameter name="HKTABLE">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Detached housekeeping (HK) table data file
        </brief>
        <description>
            <p>
                This parameter is provided in the event where the table data is not 
                readily determined from the input file.  As described in the HKFROM 
                parameter, this filename is typically contained with the KHFROM 
                label.  If for some reason, it cannot be resolved/found, this 
                parameter allows the user to provide it directly.
            </p>
            <p>
                This table contains data that is required in order for the 
                camera model to work properly.  Uncalibrated (1A) tables can be 
                used for calibrated (1B) table.
            </p>
        </description>
        <internalDefault>
          Deterministic from input files
        </internalDefault>
        <filter>
          *.img *.qub *.QUB
        </filter>
      </parameter>

      <parameter name="TO">
         <type>cube</type>
         <fileMode>output</fileMode>
         <brief>
           Output Isis cube
         </brief>
         <description>
           Use this parameter to select the output filename of the ISIS cube 
           generated by this application.
         </description>
         <filter>
           *.cub
         </filter>
       </parameter>

    </group>
    <group name="Parameters">
        <parameter name="TARGET">
            <type>string</type>
            <brief>Provide target name if it needs to be changed</brief>
            <description>
                This parameter may be necessary as some EDR labels do not adequately defined
                the TARGET_NAME keyword in the labels.  DAWN has a long cruise 
                period before ariving at Vesta in August 2011.  During cruise, 
                a Mars flyby and stellar observatoins will occur.  The proper 
                specification of the TARGET_NAME is critical to valid 
                instantiation of ISIS camera models. 

                 There are many star observations being made and in order to 
                 properly instantiate the ISIS camera model, the target must be 
                 a recognized NAIF body or "Sky".  NAIF bodies provide the means 
                 to map image coordinates to latitude/longitude values.  "Sky" 
                 is a special instantiation within ISIS that provides the 
                 ability to map image coordinates to RA/DEC coordinates.
                
                The default is to honor the value in the  EDR label.  For some 
                observed targets, "Sky" would be required in order to properly 
                instantiate the camera model.
            </description>
            <internalDefault>Label Value</internalDefault> 
        </parameter>
    </group>
  </groups>
</application>
