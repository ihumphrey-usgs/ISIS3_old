<?xml version="1.0" encoding="UTF-8"?>

<application name="cnetmerge" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">

  <brief>
    Merges multiple Control Networks into one
  </brief>

  <description>
    <p>
      This program attempts to merge a set of (two or more) Control Networks
      into a single network.  The merging process starts with a "base" network
      into which each successive network is "added".  When conflicts arise
      between the base network and the network being added, a set of
      user-defined rules are used to determine how the conflicts are resolved.
      Each network must share the same target and be of the same type (i.e.,
      Singleton, ImageToImage, ImageToGround).
    </p>
  </description>

  <history>
    <change name="Christpher Austin" date="2008-04-04">
      Original version
    </change>
    <change name="Christopher Austin" date="2008-06-24">
      Clarified error messages and added documentation.  (Removed netmerge from
      the system, because it did the same thing, just not quite as clean)
    </change>
    <change name="Christopher Austin" date="2008-08-05">
      Fix xml app name error
    </change>
    <change name="Christopher Austin" date="2008-11-13">
      Rebuilt for more Control Point Id control, including a REPLACE option.
      Only FORCE prefixes the original Control Network Id to the new Control
      Point Ids, then logs the number of duplicate Control Points.  NORMAL and
      REPLACE leave the Control Point Ids alone.
    </change>
    <change name="Christopher Austin" date="2009-01-09">
      Added the FROMLIST input option.
    </change>
    <change name="Christopher Austin" date="2009-01-13">
      Changed MERGETYPE param name and options to be more clear. Changed MODE
      to INPUTTYPE. Added the REPORT param which reveals any Control Points
      that have been renamed or replaced durring the merge.
    </change>
    <change name="Christopher Austin" date="2009-01-15">
      Added Filename expansion to the listed nets and a few other minor
      readability changes.
    </change>
    <change name="Christopher Austin" date="2009-11-19">
      Multiple changes based on user request, including removal of RENAME,
      replacing REPLACE with MERGE while merging at the Control Measure level.
    </change>
    <change name="Christopher Austin" date="2010-03-15">
      Changed an outdated error message.
    </change>
    <change name="Steven Lambright" date="2010-10-19">
      Updated to work with recent control network changes
    </change>
    <change name="Christopher Austin" date="2011-01-19">
      Altered to compile with the new Control redesign.
    </change>
    <change name="Christopher Austin" date="2011-02-25">
      Fixed a simple pointer ownership issue.
    </change>
    <change name="Steven Lambright" date="2011-04-11">
      Updated parameter names
    </change>
    <change name="Travis Addair" date="2011-05-26">
      Separated reference resolution control out of OVERWRITEMEASURES and into
      new parameter OVERWRITEREFERENCE.
    </change>
    <change name="Travis Addair" date="2011-05-27">
      Overhauled documentation to better explain the distinction between the
      base Control Network and the networks being added into it.
    </change>
    <change name="Debbie A. Cook and Tracie Sucharski" date="2011-06-07">
      Change point type "Ground" to "Fixed"
    </change>
    <change name="Travis Addair" date="2011-05-27">
      Overhauled the application to reflect functional changes to the program,
      and fix inconsistencies between the documentation and the code.  The
      program now operates without regard for point type, and properly honors
      all OVERWRITE options in all situations, which fixes #230.  A fourth
      option has been added, OVERWRITEMISSING, which will remove measures that
      do not appear in newer networks being added to the base, which fixes #228.
      The log file has been revamped to print out a PVL report for each network,
      and each conflicting point or measure.  Every conflict will be reported
      along with a reason (based on user parameter options) for the ultimate
      resolution.  This is in reference to issue #229, but more logging will
      need to be done in order to warn the user of potential pitfalls in their
      selected options.
    </change>
  </history> 

  <category>
    <categoryItem>Control Networks</categoryItem>
  </category>

  <groups>
    <group name="Input">
      <parameter name = "INPUTTYPE">
        <type>string</type>
        <default><item>LIST</item></default>
        <brief>How the program should retrieve its input</brief>
        <description>
          This parameter specifies whether the program should take its input
          from a list of Control Networks to be merged (LIST) or directly from
          a pair of parameters specifying a base and add network (CNETS).
        </description>
        <list>
          <option value = "LIST">
            <brief>Merge a list of networks</brief>
            <description>
              This option will have the program retrieve its input from a list
              of Control Networks (one per line), and merge them one by one.
              The first network in the list acts as the initial "base" network
              into which each successive network is "added".  The last network
              in the file is the last network to be added to the network, and
              thus will have either highest or lowest priority in certain
              conflict resolutions depending on the options specified in the
              "Conflict Resolution" parameter group.
            </description>
            <exclusions>
              <item>CNET</item>
              <item>CNET2</item>
            </exclusions>
          </option>
          <option value = "CNETS">
            <brief>Merge a pair of networks</brief>
            <description>
              Selecting this option is like providing a list of networks to be
              merged with only two networks.  The first network (CNET) will
              act as the base network, and the second network (CNET2) will act
              as the network being "added".
            </description>
            <exclusions>
              <item>CLIST</item>
            </exclusions>
          </option>
        </list>
      </parameter>

      <parameter name = "CLIST">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          List of Control Networks to be merged
        </brief>
        <description>
          Starting from the first network in the list as the "base", the
          program will "add" each following network in the order specified by
          this list to produce the output.  When conflicts arise, they are
          resolved in accordance with the options in the "Conflict Resolution"
          group.
        </description>
        <filter>
          *.txt *.lis *.list *.lst
        </filter>
      </parameter>

      <parameter name="CNET">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          "Base" Control Network
        </brief>
        <description>
          The "base" Control Network into which the second control network
          will be "added".  When an overwrite option in "Conflict Resolution"
          is set to FALSE, the conflicting value from this network will be
          retained.
        </description>
        <filter>
          *.ctl *.pvl *.net
        </filter>
      </parameter>

      <parameter name="CNET2">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Control Network to be "added"
        </brief>
        <description>
          The Control Network to be "added" into the base network.  When an
          overwrite option in "Conflict Resolution" is set to TRUE, the
          conflicting value from this network will replace the existing value
          in the base network.
        </description>
        <filter>
          *.ctl *.pvl *.net
        </filter>
      </parameter>
    </group>

    <group name="Output">
      <parameter name="ONET">
        <type>filename</type>
        <fileMode>output</fileMode>
        <brief>
          Merged Control Network
        </brief>
        <description>
          The output Control Network, which is the merged result of the input
          networks.
        </description>
        <filter>
          *.ctl *.pvl *.net
        </filter>
      </parameter>

      <parameter name="NETWORKID">
        <type>string</type>
        <brief>The NetworkId for the merged ControlNet</brief>
        <description>
          The NetworkId keyword for the newly merged ControlNet will be set to
          the given value.
        </description>
      </parameter>

      <parameter name="DESCRIPTION">
        <type>string</type>
        <brief>The Description for the merged ControlNet</brief>
        <description>
          The Descrition keyword for the newly merged ControlNet will be set
          to the given value.
        </description>
      </parameter>

      <parameter name="LOG">
        <type>filename</type>
        <fileMode>output</fileMode>
        <internalDefault>None</internalDefault>
        <brief>
          Reports Control Points that conflicted
        </brief>
        <description>
          This file will contain a report that reveals all Control Points that
          were conflicted during the merging process. If no Control Points
          conflicted, then this file will be empty.
        </description>
      </parameter>
    </group>

    <group name="Conflict Resolution">
      <parameter name="DUPLICATEPOINTS">
        <type>string</type>
        <brief>
          How to handle Control Points appearing in both base and add networks
        </brief>
        <default><item>ERROR</item></default>
        <description>
          This parameter specifies how conflicting Control Points between two
          networks are handled when merging.  The current options are to throw
          an error when a Control Point appears in both the base and add
          networks (ERROR), or to attempt to merge the conflicts in the
          duplicated point (MERGE).
        </description>
        <list>
          <option value="ERROR">
            <brief>Disallow merging networks with duplicate points</brief>
            <description>
              This option will check for conflicting Control Points in the
              Control Networks and throw an error when a conflict occurs.
              If no conflict occurs, all Control Points will be added
              without changing any existing points in the base network.  For
              the purposes of this parameter, a conflict can be as simple as
              two Control Points sharing the same ID.  In such a case, an
              error will be thrown, even if nothing else is different
              between them.
            </description>
            <exclusions>
              <item>LOG</item>
              <item>OVERWRITEPOINTS</item>
              <item>OVERWRITEMEASURES</item>
              <item>OVERWRITEREFERENCE</item>
              <item>OVERWRITEMISSING</item>
            </exclusions>
          </option>
          <option value="MERGE">
            <brief>Merge duplicate points and resolve their conflicts</brief>
            <description>
              This option will attempt to merge duplicate points between the
              base network and the successive networks being added to it.
              When conflicts arise, they will be resolved in accordance with
              the various overwrite parameters.  By default, values in the
              base network will take priority over those in the networks
              added to it, but this can be changed using these parameters.
              For example, if OVERWRITEMEASURES is set to TRUE, then
              Line/Sample values in the last network added will take
              precedence over all the Line/Sample values for conflicting
              measures in the base network and the networks that were added
              prior.
            </description>
          </option>
        </list>
      </parameter>

      <parameter name="OVERWRITEPOINTS">
        <type>boolean</type>
        <default><item>False</item></default>
        <brief>Replace conflicting points as networks are added</brief>
        <description>
          Whenever a latitude or longitude value conflicts between the base
          network and the network being added on a fixed Control Point,
          then the value in the base network will be replaced with that
          from the add network when this option is TRUE.  When this options is
          FALSE, the conflict will be noted in the LOG file (if provided), but
          the value from base will be retained in the output network.
        </description>
      </parameter>

      <parameter name="OVERWRITEMEASURES">
        <type>boolean</type>
        <default><item>False</item></default>
        <brief>Replace conflicting measures as networks are added</brief>
        <description>
          Whenever a Control Measure conflicts between the base network and
          the network being added on a fixed Control Point, then the measure
          in the base network will be replaced with that from the add
          network when this option is TRUE.  When this options is FALSE, the
          conflict will be noted in the LOG file (if provided), but the
          measure from base will be retained in the output network.
        </description>
      </parameter>

      <parameter name="OVERWRITEREFERENCE">
        <type>boolean</type>
        <default><item>False</item></default>
        <brief>
          Replace reference measures in conflicting points as networks are added
        </brief>
        <description>
          When this parameter is true, if a Control Point in the current
          "base" network and the current network being added to it have
          different reference measures, there is ambiguity about which measure
          should be defined as the one and only "reference measure" in the
          output Control Network.  When this parameter is set to TRUE, the
          reference measure in the network being added will overwrite the
          existing reference status of the reference measure in the base
          network.  If FALSE, the base reference will be retained.  In both
          cases, both measures make it into the final network, but only one
          will be listed as the reference for that point.
        </description>
      </parameter>

      <parameter name="OVERWRITEMISSING">
        <type>boolean</type>
        <default><item>False</item></default>
        <brief>
          Measures missing in newer networks will not appear in the output
        </brief>
        <description>
          When this parameter is true, if a measure exists in a conflicting
          point in the base network, but not the new network being added to it,
          then the missing measure will not appear in that point in the output
          Control Network.  By default, this option is set to false, and if a
          measure exists in either the base or the new network, it will appear
          in the output as well.
        </description>
      </parameter>
    </group>
  </groups>
</application>
