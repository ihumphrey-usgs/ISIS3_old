<?xml version="1.0"?>
<application name="deltack" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">
  <brief>
    Update camera pointing for a single image
  </brief>

  <description>
    <p>
    This program can be used to update camera pointing in the labels of a single
    cube (resection).  Like "jigsaw", it works on both framing cameras and line
    scanners.  The user must supply a latitude/longitude for at least one single
    sample/line coordinate in the image.  Angles 1 and 2 of the camera pointing
    stored in the cube labels will be adjusted to align the coordinate with the
    entered latitude/longitude.  To solve for all three camera angles select the
    TWIST option.  A second coordinate point and desired latitude/longitude must 
    be entered for the TWIST option.  The application will adjust the camera
    angles to align both points with the entered latitude/longitudes with minimal 
    errors.  In order for this program to work properly, the cube must have been 
    initialized with the "spiceinit" program using ATTACH="YES".
    </p>

    <p>
    The camera pointing is updated using an iterative least-squares bundle
    adjustment.  The number of iterations and tolerance (sigma0) for 
    convergence are input parameters to this program.  Solving for two angles
    only is similar to a translation of the image.  Solving for the twist as well
    will result in both a translation and a rotation.
    </p>
  </description>

  <category>
    <categoryItem>Control Networks</categoryItem>
  </category>

  <seeAlso>
    <applications>
      <item>jigsaw</item>
    </applications>
  </seeAlso>

  <history>
    <change name="Jeff Anderson" date="2006-09-06">
      Original version
    </change>
    <change name="Tracie Sucharski" date="2007-05-02">
        Added inclusion of TWIST to SAMP2,LINE2,LAT2,LON2,RAD2.  
        Without this inclusion, the AML was requiring these parameters
        even if TWIST was false.
    </change>
    <change name="Debbie A. Cook" date="2007-07-12">
        Added pvl status report for a successful update.
    </change>
    <change name="Steven Koechle" date="2007-10-05">
      Added check to see if cube has existing polygon, if so delete it.
    </change>
    <change name="Debbie A. Cook" date="2011-06-06">
        Updated to current version of BundleAdjust class.
    </change>
    <change name="Debbie A. Cook" date="2011-06-07">
        Changed point type "Ground" to "Fixed".
    </change>
    <change name="Debbie A. Cook" date="2011-09-28">
        Updated documentation in response to Mantis issue #187.
    </change>
  </history>

  <groups>
    <group name="Files">
      <parameter name="FROM">
        <type>cube</type>
        <fileMode>input</fileMode>
        <brief>
          Input camera cube
        </brief>
        <description>
  	   The file specification for the input cube.   The cube will have
           its camera pointing updated.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>
    </group>

    <group name="Bundle Adjustment Options">
      <parameter name="SIGMA0">
        <brief>Standard deviation of unit weight</brief>
        <description>
           Convergence is reached when the solution parameters change by 
           less than Sigma0.
        </description>
        <type>double</type>
        <default><item>1.0e-10</item></default>
      </parameter>

      <parameter name="MAXITS">
        <brief>Iterations</brief>
        <description>Maximum number of iterations</description>
        <type>integer</type>
        <default><item>10</item></default>
      </parameter>
      <parameter name="TWIST">
        <type>boolean</type>
        <brief>Solve for camera twist</brief>
        <default><item>False</item></default>
        <description>
          In addition to angle1 and angle2, if this parameter is set the program 
          will solve for the camera twist.  This requires input of a second 
          fixed coordinate (SAMP2,LINE2) and (LAT2,LON2)
        </description>
        <inclusions>
          <item>LINE2</item>
          <item>SAMP2</item>
          <item>LAT2</item>
          <item>LON2</item>
          <item>RAD2</item>
        </inclusions>
      </parameter>
   </group>

   <group name="Fixed Points">
     <parameter name="SAMP1">
       <type>double</type>
       <brief>Sample coordinate</brief>
       <description>
          The sample coordinate for fixed point #1 (LAT1,LON1).
       </description>
     </parameter>

     <parameter name="LINE1">
       <type>double</type>
       <brief>Line coordinate</brief>
       <description>
          The line coordinate for fixed point #1 (LAT1,LON1)
       </description>
     </parameter>

     <parameter name="LAT1">
       <type>double</type>
       <brief>Latitude</brief>
       <description>
          Planetocentric latitude at the image coordinate (SAMP1,LINE1)
       </description>
       <minimum inclusive="yes">-90.0</minimum>
       <maximum inclusive="yes">90.0</maximum>
     </parameter>

     <parameter name="LON1">
       <type>double</type>
       <brief>Longitude</brief>
       <description>
          Planetocentric longitude at the image coordinate (SAMP1,LINE1)
       </description>
       <minimum inclusive="yes">0.0</minimum>
       <maximum inclusive="yes">360.0</maximum>
     </parameter>

     <parameter name="RAD1">
       <type>double</type>
       <brief>Radius</brief>
       <internalDefault>Computed</internalDefault>
       <description>
          Radius in meters at the image coordinate (SAMP1,LINE1).  It 
          will be automatically computed using the shape model that was
          entered in the "spiceinit" application.
       </description>
       <minimum inclusive="no">0.0</minimum>
     </parameter>

     <parameter name="SAMP2">
       <type>double</type>
       <brief>Sample coordinate</brief>
       <description>
          The sample coordinate for fixed point #2 (LAT2,LON2)
       </description>
       <inclusions>
           <item>TWIST</item>
       </inclusions>
     </parameter>

     <parameter name="LINE2">
       <type>double</type>
       <brief>Line coordinate</brief>
       <description>
          The line coordinate for fixed point #2 (LAT2,LON2)
       </description>
       <inclusions>
           <item>TWIST</item>
       </inclusions>
     </parameter>

     <parameter name="LAT2">
       <type>double</type>
       <brief>Latitude</brief>
       <description>
          Planetocentric latitude at the image coordinate (SAMP2,LINE2)
       </description>
       <minimum inclusive="yes">-90.0</minimum>
       <maximum inclusive="yes">90.0</maximum>
       <inclusions>
          <item>TWIST</item>
       </inclusions>
     </parameter>

     <parameter name="LON2">
       <type>double</type>
       <brief>Longitude</brief>
       <description>Planetocentric longitude at the image coordinate (SAMP2,LINE2)</description>
       <minimum inclusive="yes">0.0</minimum>
       <maximum inclusive="yes">360.0</maximum>
       <inclusions>
           <item>TWIST</item>
       </inclusions>
     </parameter>

     <parameter name="RAD2">
       <type>double</type>
       <brief>Radius</brief>
       <internalDefault>Computed</internalDefault>
       <description>
         Radius in meters at the image coordinate (SAMP2,LINE2).  It will 
         be automatically computed using the shape model that was 
         initialized in the "spiceinit" application.
       </description>
       <minimum inclusive="no">0.0</minimum>
       <inclusions>
          <item>TWIST</item>
       </inclusions>
     </parameter>
   </group>
  </groups>

</application>
