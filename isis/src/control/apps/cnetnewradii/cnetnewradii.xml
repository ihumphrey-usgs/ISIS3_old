<?xml version="1.0" encoding="UTF-8"?>

<application name="cnetnewradii" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://isis.astrogeology.usgs.gov/Schemas/Application/application.xsd">
  <brief>
    Generate new radii from DEM for a ControlNet
  </brief>

  <description>
    <p>
      This application will go through an existing ControlNet and copy it to a new 
      one. When it encounters a point type of Fixed or Constrained it will use the 
      control point latitude and longitude to get the radius from the DEM.  The 
      radius will be calculated based on a bilinear interpolation of the closest
      pixels in the DEM. 
    </p>
    <p>
      If, for a particular point, the application fails to calculated a radius using
      the DEM, then the input Radius value is kept and the 
      point is set to Ignore=true.  The number of these failures 
      are recorded in the application's log.  The Point IDs for the 
      corresponding control points will be listed in the ERRORS log output file.  
      If the user did not enter a filename for this log and there are any 
      points that failed, one will be created with the name "failures.log".  
      <strong>Note: </strong> If a significant number of fixed points in the 
      ControlNet fail to find a new Radius value, the user should make sure 
      that they have input the correct DEM for the network.  
    </p>
  </description>

  <category>
    <categoryItem>Control Networks</categoryItem>
  </category>

  <history>
    <change name="Steven Koechle" date="2008-08-05">
      Original Version
    </change>
    <change name="Jeannie Walldren" date="2010-05-25">
      Modified to handle control points that fail to calculate a new radius as 
      explained in the description. Added ERRORS parameter to list PointIDs of 
      the control points that failed to calculate a new radius. Added filters 
      for input and output parameters. 
    </change>
    <change name="Jeannie Walldren" date="2010-05-27">
      Created examples. 
    </change>
    <change name="Christopher Austin" date="2011-01-19">
      Altered to compile with the new Control redesign.
    </change>
    <change name="Steven Lambright" date="2011-02-09">
      Updated to not try to project null lat,lon values
    </change>
    <change name="Christopher Austin" date="2011-03-14">
      Updated for Control Point's removal of Set/GetSurfacePoint() and added
      the GetLatLon parameter.
    </change>
    <change name="Steven Lambright" date="2011-04-11">
      Changed the DEM parameter name to MODEL
    </change>
    <change name="Debbie A. Cook and Tracie Sucharski" date="2011-06-07">
      Changed the point type "Ground" to "Fixed"
    </change>
    <change name="Tracie Sucharski" date="2011-07-28">
      Change radii values for both Fixed and Constrained points.   Use bilinear
      interpolation to get the correct radius from the DEM.  This uses the same
      interpolation as the camera.  Print error  if there are no Fixed or Constrained
      points in the network.  Change input parameter names to be consistent with
      those suggested on the Astrogeology wiki page.  Removed NETWORKID
      as user parameter since it should carry the ID from the input control net.
      Set Apriori as the default for the GETLATLON parameter.  Update examples
      documentation  .
    </change>
  </history>

  <groups>
    <group name="Files">
      <parameter name="CNET">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Input ControlNet
        </brief>
        <description>
          Use this parameter to select the input ControlNet to generate the 
          output from.
        </description>
        <filter>
          *.net
        </filter>
      </parameter>

      <parameter name="MODEL">
        <type>filename</type>
        <fileMode>input</fileMode>
        <brief>
          Input DEM cube
        </brief>
        <description>
          Use this parameter to select the DEM to use with the original 
          ControlNet.
        </description>
        <filter>
          *.cub
        </filter>
      </parameter>

      <parameter name="ONET">
        <type>filename</type>
        <fileMode>output</fileMode>
        <brief>
          Output ControlNet file 
        </brief>
        <description>
          Use this parameter to specify the name of the output ControlNet.
        </description>
        <filter>
          *.net
        </filter>
      </parameter>

      <parameter name="ERRORS">
        <type>filename</type>
        <fileMode>output</fileMode>
        <internalDefault>No Error Output</internalDefault>
        <brief>
          Optional log file containing failures.
        </brief>
        <description>
          This file will contain the Point IDs of all control points whose 
          radius could not be calculated from the DEM.  This happens when the 
          radius value is a special pixel or when the program fails to set 
          universal ground given the lat/lon values of the control point.
        </description>
        <filter>
          *.log *.pvl *.txt 
        </filter>
      </parameter>
    </group>

    <group name="Parameters">
      <parameter name="GETLATLON">
        <type>string</type>
        <default><item>APRIORI</item></default>
        <brief>The lat/lon used to set the new radii</brief>
        <description>
        Specify the Surface Point to use when setting the new radii.
        </description>
        <list>
          <option value="APRIORI">
            <brief>Use the Apriori Surface Point</brief>
            <description>
               Use the lat/lon values provided by the Apriori Surface Point
               when setting the new radii.
            </description>
          </option>
          <option value="ADJUSTED">
            <brief>Use the Adjusted Surface Point</brief>
            <description>
               Use the lat/lon values provided by the Adjusted Surface Point
               when setting the new radii. The lat/lon value of the Adjusted
               Surface Point is generated by bundle adjust.
            </description>
          </option>
         </list>
      </parameter>
    </group>
  </groups>

  <examples>
    <example>
      <brief>All fixed points successfully updated </brief>
      <description>
        Example of the use of cnetnewradii on a ControlNet whose fixed point 
        lat/lon values are all contained within the given DEM.
      </description>
      <terminalInterface>
        <commandLine>
          cnet=../IN/inputcnet.net model=../IN/inputDEM1.cub 
          onet=../OUT/ouputcnet1.net getlatlon=APRIORI
        </commandLine>
        <description>
          In this example, cnetnewradii will take the input control network and 
          copy it to the output network with new Radius values calculated for 
          all fixed points using an interpolated  DN value from the DEM cube. 
          The apriori values will be updated.  No error log will be generated.
        </description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/cnetnewradiiGui1.jpg" width="719" height="550">
            <brief>
              Example GUI
            </brief>
            <description>
              Screen shot of GUI with parameters filled in to create ControlNet 
              with new Radius values. 
            </description>
            <thumbnail caption="" src="assets/thumbs/cnetnewradiiGui1Thumb.jpg" width="200" height="153"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <dataFiles>
        <dataFile path="assets/inputcnet.net.pvl">
          <brief>Input ControlNet for cnetnewradii </brief>
          <description>
            Example of an input ControlNet whose Radius values will be updated
          </description>
          <parameterName>CNET</parameterName>
        </dataFile>
        <dataFile path="assets/outputcnet1.net.pvl">
          <brief>Output ControlNet for cnetnewradii </brief>
          <description>
            Example of an output ControlNet corresponding to the input example 
            with updated Radius values.  Notice that Radius values have been 
            updated for all fixed points.
          </description>
          <parameterName>TO</parameterName>
        </dataFile>
      </dataFiles>
      <inputImages>
        <image src="assets/images/inputDEM1.jpg" width="716" height="550">
          <brief>Input DEM for cnetnewradii</brief>
          <description>
            Example of an input DEM cube used by cnetnewradii to update the 
            Radius values of fixed points in the ControlNet.
          </description>
          <thumbnail caption="DEM " src="assets/thumbs/inputDEM1Thumb.jpg" width="200" height="154"/>
          <parameterName>DEM</parameterName>
        </image>
      </inputImages>
    </example>
    <example>
      <brief>Some fixed points fail to be updated </brief>
      <description>
        Example of the use of cnetnewradii on a ControlNet that contains some 
        fixed points whose Radius can not be calculated.
      </description>
      <terminalInterface>
        <commandLine>
          cnet=../IN/inputcnet.pvl model=../IN/inputDEM2.cub 
          onet=../OUT/ouputcnet2.pvl errors=../OUT/failures.pvl
        </commandLine>
        <description>
          In this example, cnetnewradii will take the input control network and 
          copy it to the output network with new Radius values calculated for 
          fixed points using the DN value recieved from the DEM cube. The 
          PointIDs of fixed points that fail to calculate a new Radius value 
          will be listed in the error log. 
        </description>
      </terminalInterface>
      <guiInterfaces>
        <guiInterface>
          <image src="assets/images/cnetnewradiiGui2.jpg" width="719" height="550">
            <brief>
              Example GUI
            </brief>
            <description>
              Screen shot of GUI with parameters filled in to create ControlNet 
              with new Radius values. 
            </description>
            <thumbnail caption="" src="assets/thumbs/cnetnewradiiGui2Thumb.jpg" width="200" height="153"/>
          </image>
        </guiInterface>
      </guiInterfaces>
      <dataFiles>
        <dataFile path="assets/inputcnet.net.pvl">
          <brief>Input ControlNet for cnetnewradii </brief>
          <description>
            Example of an input ControlNet whose Radius values will be updated
          </description>
          <parameterName>CNET</parameterName>
        </dataFile>
        <dataFile path="assets/failures.pvl">
          <brief>Output error log for cnetnewradii </brief>
          <description>
            Example of an output error log containing the PointIDs of all points 
            that failed to calculate a new Radius value. 
          </description>
          <parameterName>ERRORS</parameterName>
        </dataFile>
        <dataFile path="assets/outputcnet2.net.pvl">
          <brief>Output ControlNet for cnetnewradii </brief>
          <description>
            Example of an output ControlNet corresponding to the input example 
            with updated Radius values.  Notice that the fixed points 
            that failed are set to Ignore=True and their original radius values 
            are retained.
          </description>
          <parameterName>TO</parameterName>
        </dataFile>
        </dataFiles>
      <inputImages>
        <image src="assets/images/inputDEM2.jpg" width="716" height="550">
          <brief>Input DEM for cnetnewradii</brief>
          <description>
            Example of an input DEM cube used by cnetnewradii to update the 
            Radius values of fixed points in the ControlNet.
          </description>
          <thumbnail caption="DEM " src="assets/thumbs/inputDEM2Thumb.jpg" width="200" height="154"/>
          <parameterName>DEM</parameterName>
        </image>
      </inputImages>
    </example>
  </examples>

</application>
